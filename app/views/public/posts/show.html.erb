<%= render "layouts/sidebar_left", posts: @sidebar_posts %>
<div class="col-8 border px-5">
  <h2 class="text-center my-4">投稿詳細</h2>
  <h5 class="text-right my-2">
    <% if user_signed_in? %>
      <% if @post.bookmarked_by?(current_user) %>
        <%= link_to "ブックマークを外す", post_bookmark_path(@post), class: "btn btn-danger btn-sm", method: :delete %>
      <% else %>
        <%= link_to "投稿をブックマーク", post_bookmarks_path(@post), class: "btn btn-primary btn-sm", method: :post %>
      <% end %>
    <% end %>
  </h5>

  <% if user_signed_in? && current_user.id == @post.user_id %>
    <%= form_with model: @post do |f| %>
      <div class="d-flex">
        <div class="col-4">
          <%= image_tag @post.get_post_image, height: "200" %>
        </div>
        <table class="col-8 table table-borderless">
          <tr>
            <th class="text-center" sytle="width: 200px">投稿タイトル</th>
            <td><%= f.text_field :title %></td>
          </tr>
          <tr>
            <th class="text-center" style="width: 200px">投稿ユーザー</th>
            <td>
              <div><%= @post.user.name %>さん</div>
            </td>
          </tr>
          <tr>
            <th class="text-center">釣行日・時間帯</th>
            <td><%= f.date_field :date %> <%= f.collection_select :time_zone_id, TimeZone.all, :id, :time_zone %></td>
          </tr>
          <tr>
            <th class="text-center">釣り場</th>
            <td><%= f.collection_select :area_id, Area.all, :id, :name %></td>
          </tr>
          <tr>
            <th class="text-center">メインの釣果</th>
            <td><%= f.collection_select :species_id, Species.all, :id, :name %> <%= f.number_field :catch_number, min: 1, class: "w-25" %>匹</td>
          </tr>
          <tr>
            <th class="text-center">釣法</th>
            <td><%= f.collection_select :fishing_method_id, FishingMethod.all, :id, :name %></td>
          </tr>
          <tr>
            <th class="text-center">コメント</th>
            <td><%= f.text_area :comment %></td>
          </tr>
          <tr>
            <th class="text-center">公開設定</th>
            <td><%= f.select :status, [["公開","true"], ["非公開","false"]] %></td>
          </tr>
          <tr>
            <td></td>
            <td><%= f.submit "編集内容を保存", class: "btn btn-success btn-sm w-100" %></td>
          </tr>
        </table>
      </div>
    <% end %>
  <% else %>
    <div class="d-flex">
      <div class="col-4">
        <%= image_tag @post.get_post_image, height: "200" %>
      </div>
      <table class="col-8 table table-borderless">
        <tr>
          <th class="text-center" sytle="width: 200px">投稿タイトル</th>
          <td><%= @post.title %></td>
        </tr>
        <tr>
          <th class="text-center" style="width: 200px">投稿ユーザー</th>
          <td>
            <div><%= link_to "#{@post.user.name}さん", user_path(@post.user_id) %></div>
            <div class="text-right">
              <% if user_signed_in? %>
                <% if current_user.following?(@post.user) %>
                  <%= link_to "フォロー外す", user_relationships_path(@post.user.id), class: "btn btn-danger btn-sm", method: :delete %>
                <% else %>
                  <%= link_to "フォローする", user_relationships_path(@post.user.id), class: "btn btn-primary btn-sm", method: :post %>
                <% end %>
              <% end %>
            </div>
          </td>
        </tr>
        <tr>
          <th class="text-center">釣行日・時間帯</th>
          <td><%= @post.date %> <%= @post.time_zone.time_zone %></td>
        </tr>
        <tr>
          <th class="text-center">釣り場</th>
          <td><%= @post.area.name %></td>
        </tr>
        <tr>
          <th class="text-center">メインの釣果</th>
          <td><%= @post.species.name %> <%= @post.catch_number %>匹</td>
        </tr>
        <tr>
          <th class="text-center">釣法</th>
          <td><%= @post.fishing_method.name %></td>
        </tr>
        <tr>
          <th class="text-center">投稿者のコメント</th>
          <td><%= @post.comment %></td>
        </tr>
      </table>
    </div>
  <% end %>

  <div class="col-8 offset-4">
    <div>
      <div class="text-center mb-2">コメント件数：<%= @post.comments.count %></div>
      <div class="border-bottom"></div>
      <% @post.comments.each do |comment| %>
        <div><%= comment.user.name %>さん</div>
        <div class="mx-3"><%= comment.comment %></div>
        <div class="text-right border-bottom"><%= comment.created_at.strftime('%Y/%m/%d') %></div>
      <% end %>
    </div>
    <div>
      <% if user_signed_in? %>
        <%= form_with model: [@post, @comment] do |f| %>
          <div><%= f.text_area :comment, rows: "5", placeholder: "コメントを入力", class: "mt-3 w-75" %></div>
          <div><%= f.submit "送信", class: "btn btn-success mb-3 w-50" %></div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<%= render "layouts/sidebar_right" %>